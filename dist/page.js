window.$page=function(e,t){"use strict";for(var n="",a=!1,r=function(e){for(var t={},n=e.split("/"),a=[],r=[],o=0,i=n.length;i>o;o++){var d=n[o];d=d.replace(/\{:(.+)\}/,"([^/]+?)"),a.push(d),RegExp.$1.length&&r.push(RegExp.$1)}var u=a.join("/"),f=u.substring(u.length-1,u.length);return"/"==f&&(u=u.substring(0,u.length-1)),u="^"+u+"/?$",t.regex=new RegExp(u),t.map=r,t},o=Object.keys(e),i=[],d=o.length,u=0;d>u;u++){var f=o[u];if("$notFound"!==f){var p=r(f),g={matcher:p,data:e[f],route:f};i.push(g)}else a=!0}var l="",s="";"undefined"!=typeof t&&"undefined"!=typeof t.templateEngine&&(s=t.templateEngine,l=t.templateRoot||"#page-templates");var h=function(t,r){n=t;var o=!1;"undefined"==typeof r&&(r=!1);for(var d=0,u=i.length;u>d;d++){var f=i[d],p=f.matcher;if(p.regex.test(t)){for(var g={},h=0,v=p.map.length;v>h;h++)g[p.map[h]]=RegExp["$"+(h+1)];if("undefined"==typeof f.data.handler){console.error("No handler defined for route: "+f.route);break}if(o=!0,f.data.handler.bind(this)(g,c,r),"undefined"!=typeof f.data.template){var m=document.getElementById(l),w=s(f.data.template,g);m.innerHTML=w}break}}!o&&a&&e[c.get404Route()].handler.bind(this)({},c,r)},c={route:h,currentRoute:function(){return n},get404Route:function(){return a?"$notFound":void 0}},v=window.location.pathname;h(v);var m=function(e){window.history.pushState(null,null,e),h(e)};"undefined"!=typeof t&&"undefined"!=typeof t.hijackLinks&&t.hijackLinks===!0&&document.body.addEventListener("click",function(e){if("a"===e.target.tagName.toLowerCase()){var t="";return t="undefined"!=typeof e.target.dataset.getAttribute?e.target.dataset.getAttribute("href"):e.target.dataset.href,m(t),e.preventDefault(),e.stopPropagation(),!1}},!0);var w=function(){h(window.location.pathname,!0)};return window.addEventListener("popstate",function(){w()}),c};